---
title: JVMæ€§èƒ½ä¼˜åŒ–
date: 2026-02-09 13:04:53
permalink: /pages/dafd11/
---

ä½ å¥½å‘€ï¼Œæˆ‘çš„è€æœ‹å‹ï¼æˆ‘æ˜¯è€å¯‡ï¼Œæ¬¢è¿æ¥åˆ°è€å¯‡IoTäº‘å¹³å°ï¼

### ä¼˜åŒ–ARM JVMæ€§èƒ½ã€1Gå†…å­˜ã€‘

##### ğŸš€ å®‰è£…ä¸å¸è½½JDK25

```shell
# å®‰è£…
sudo pacman -Syy
sudo pacman -S jdk25-openjdk
# å¸è½½
sudo pacman -R jdk25-openjdk
```

##### ğŸš€ è°ƒæ•´å†…å­˜

<font color="red">ğŸ‘‰ æ³¨æ„ï¼šä¸€æ—¦ JVM å‘ç”Ÿ OOMï¼Œç«‹åˆ»ã€ç›´æ¥é€€å‡ºè¿›ç¨‹ï¼ˆkill -9çº§åˆ«ï¼‰</font>

```shell
java \
  -Xms256m \
  -Xmx256m \
  -XX:MaxMetaspaceSize=128m \
  -XX:ReservedCodeCacheSize=32m \
  -XX:+UseSerialGC \
  -XX:MaxDirectMemorySize=32m \
  -XX:+ExitOnOutOfMemoryError \
  -jar app.jar
```

<font color="red">ğŸ‘‰ æ³¨æ„ï¼š1Gå†…å­˜ï¼Œé»˜è®¤å¼€å¯æŒ‡é’ˆå‹ç¼©</font>

```shell
# æŸ¥çœ‹å‚æ•°
java -XX:+PrintFlagsFinal -version | grep Compressed

# å¼€å¯æƒ…å†µ
# bool UseCompressedClassPointers = true
# bool UseCompressedOops = true
```

##### ğŸš€ é”æ­»å †å†…å­˜

<font color="red">ğŸ‘‰ æ³¨æ„ï¼šé˜²æ­¢JVMè¿è¡Œä¸­å·å·æ‰©å®¹</font>

<font color="red">ğŸ‘‰ æ³¨æ„ï¼šé¿å…Full GCé¢‘ç¹æŠ–åŠ¨</font>

```shell
-Xms256m -Xmx256m
```

##### ğŸš€ åƒåœ¾å›æ”¶å™¨

<font color="red">ğŸ‘‰ æ³¨æ„ï¼šG1/ZGC/Shenandoahéƒ½æœ‰é¢å¤–çº¿ç¨‹å’Œå…ƒæ•°æ®å¼€é”€</font>

<font color="red">ğŸ‘‰ æ³¨æ„ï¼šåœ¨<1GBå†…å­˜ä¸‹ï¼ŒSerial GCåè€Œæœ€çœå†…å­˜</font>

<font color="red">ğŸ‘‰ æ³¨æ„ï¼šJDK25é‡ŒSerial GCä¾ç„¶æ˜¯ç¨³å®šã€å¯ç”¨ã€ä½å ç”¨çš„</font>

```shell
-XX:+UseSerialGC
```

##### ğŸš€ é”æ­»å…ƒç©ºé—´

<font color="red">ğŸ‘‰ æ³¨æ„ï¼šåŠ è½½çš„ç±»ä¸€å¤šï¼ŒMetaspaceä¼šåƒæ‰ä½ å‰©ä½™çš„å†…å­˜</font>

<font color="red">ğŸ‘‰ æ³¨æ„ï¼šOOMå¾€å¾€ä¸æ˜¯Heapï¼Œè€Œæ˜¯Metaspace</font>

```shell
-XX:MaxMetaspaceSize=128m
```

##### ğŸš€ JITç”Ÿæˆçš„æœºå™¨ç 

```shell
-XX:ReservedCodeCacheSize=32m
```

**å°å†…å­˜ï¼ˆâ‰¤1GBï¼‰æ¨èå€¼**

| åœºæ™¯          | Code Cache        |
|-------------|-------------------|
| CLI / å·¥å…·    | 16m               |
| æ™®é€šæœåŠ¡        | 32m               |
| Spring Boot | 32m ~ 48m         |
| è¶…é«˜ QPS      | 64mï¼ˆä¸å»ºè®® 500MB ç¯å¢ƒï¼‰ |


##### ğŸš€ å †å¤–å†…å­˜

<font color="red">ğŸ‘‰ æ³¨æ„ï¼šå †å¤–å†…å­˜ï¼ŒGC åªèƒ½â€œé—´æ¥å›æ”¶â€ï¼Œå›æ”¶æ…¢ã€ä¸å¯æ§</font>

<font color="red">ğŸ‘‰ æ³¨æ„ï¼šå›æ”¶ä¾èµ–ï¼šCleanerã€å¼•ç”¨å¤±æ•ˆã€Full GC</font>

```shell
-XX:MaxDirectMemorySize=32m
```

**å¹¿ä¹‰å †å¤–å†…å­˜**

| ç±»å‹            | ä¾‹å­          |
|---------------|-------------|
| Direct Memory | NIO / Netty |
| Code Cache    | JIT æœºå™¨ç      |
| Metaspace     | ç±»å…ƒæ•°æ®        |
| JNI malloc    | æœ¬åœ°åº“         |
| Thread Stack  | æ¯ä¸ªçº¿ç¨‹çš„æ ˆ      |

##### ğŸš€ Tomcat

<font color="red">ğŸ‘‰ æ³¨æ„ï¼šçº¿ç¨‹æ ˆä¹Ÿä¼šåƒå†…å­˜ï¼ˆæ¯çº¿ç¨‹ ~1MBï¼‰</font>

```shell
server:
  tomcat:
    max-threads: 50
    accept-count: 100
```

æˆ‘æ˜¯è€å¯‡ï¼Œæˆ‘ä»¬ä¸‹æ¬¡å†è§å•¦ï¼
