---
title: ç½‘å…³è·¯ç”±é…ç½®
date: 2026-02-09 21:36:29
permalink: /pages/a0f8a0/
---

ä½ å¥½å‘€ï¼Œæˆ‘çš„è€æœ‹å‹ï¼æˆ‘æ˜¯è€å¯‡ï¼Œæ¬¢è¿æ¥åˆ°è€å¯‡IoTäº‘å¹³å°ï¼

## ğŸ“Œ æ¦‚è¿°

`RouteDefinition` æ˜¯ Spring Cloud Gateway ä¸­ç”¨äºå®šä¹‰è·¯ç”±è§„åˆ™çš„æ ¸å¿ƒå¯¹è±¡ã€‚æœ¬æ–‡æ¡£æè¿°äº† `router.json` ä¸­çš„è·¯ç”±é…ç½®è§„èŒƒã€‚

---

## ğŸ“‹ RouteDefinition ç»“æ„

| å­—æ®µ           | ç±»å‹                           | å¿…å¡« | è¯´æ˜               |
|--------------|------------------------------|----|------------------|
| `id`         | `String`                     | âœ…  | è·¯ç”±å”¯ä¸€æ ‡è¯†ç¬¦          |
| `uri`        | `String`                     | âœ…  | ç›®æ ‡æœåŠ¡åœ°å€           |
| `predicates` | `Array<PredicateDefinition>` | âœ…  | è·¯ç”±æ–­è¨€æ¡ä»¶åˆ—è¡¨         |
| `filters`    | `Array<FilterDefinition>`    | âŒ  | è¿‡æ»¤å™¨åˆ—è¡¨            |
| `metadata`   | `Object`                     | âŒ  | è·¯ç”±å…ƒæ•°æ®            |
| `order`      | `Integer`                    | âŒ  | è·¯ç”±ä¼˜å…ˆçº§ï¼ˆæ•°å€¼è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ï¼‰ |

---

## ğŸ”— URI æ ¼å¼è§„èŒƒ

| æ ¼å¼                  | è¯´æ˜                | ç¤ºä¾‹                             |
|---------------------|-------------------|--------------------------------|
| `lb://æœåŠ¡å`          | è´Ÿè½½å‡è¡¡ HTTP æœåŠ¡      | `lb://laokou-admin`            |
| `lb:ws://æœåŠ¡å`       | è´Ÿè½½å‡è¡¡ WebSocket æœåŠ¡ | `lb:ws://laokou-iot-websocket` |
| `http://host:port`  | ç›´è¿ HTTP åœ°å€        | `http://localhost:8080`        |
| `https://host:port` | ç›´è¿ HTTPS åœ°å€       | `https://api.example.com`      |
| `ws://host:port`    | ç›´è¿ WebSocket åœ°å€   | `ws://localhost:9000`          |

---

## ğŸ¯ PredicateDefinitionï¼ˆæ–­è¨€å®šä¹‰ï¼‰

### ç»“æ„

```json
{
  "name": "æ–­è¨€åç§°",
  "args": {
    "å‚æ•°å": "å‚æ•°å€¼"
  }
}
```

### å¸¸ç”¨æ–­è¨€ç±»å‹

| æ–­è¨€åç§°         | å‚æ•°                               | è¯´æ˜        |
|--------------|----------------------------------|-----------|
| `Path`       | `pattern`                        | è·¯å¾„åŒ¹é…      |
| `Weight`     | `_genkey_0`ï¼ˆåˆ†ç»„ï¼‰, `_genkey_1`ï¼ˆæƒé‡ï¼‰ | æƒé‡è·¯ç”±      |
| `Method`     | `methods`                        | HTTP æ–¹æ³•åŒ¹é… |
| `Header`     | `header`, `regexp`               | è¯·æ±‚å¤´åŒ¹é…     |
| `Query`      | `param`, `regexp`                | æŸ¥è¯¢å‚æ•°åŒ¹é…    |
| `Host`       | `patterns`                       | ä¸»æœºååŒ¹é…     |
| `After`      | `datetime`                       | æ—¶é—´ä¹‹åç”Ÿæ•ˆ    |
| `Before`     | `datetime`                       | æ—¶é—´ä¹‹å‰ç”Ÿæ•ˆ    |
| `Between`    | `datetime1`, `datetime2`         | æ—¶é—´èŒƒå›´å†…ç”Ÿæ•ˆ   |
| `Cookie`     | `name`, `regexp`                 | Cookie åŒ¹é… |
| `RemoteAddr` | `sources`                        | è¿œç¨‹åœ°å€åŒ¹é…    |

### ç¤ºä¾‹

#### Path æ–­è¨€

```json
{
  "name": "Path",
  "args": {
    "pattern": "/admin/**"
  }
}
```

#### Weight æ–­è¨€ï¼ˆæƒé‡è·¯ç”±ï¼‰

```json
{
  "name": "Weight",
  "args": {
    "_genkey_0": "admin",
    "_genkey_1": "100"
  }
}
```

> - `_genkey_0`ï¼šåˆ†ç»„åç§°
> - `_genkey_1`ï¼šæƒé‡å€¼ï¼ˆ0-100ï¼‰

---

## ğŸ”§ FilterDefinitionï¼ˆè¿‡æ»¤å™¨å®šä¹‰ï¼‰

### ç»“æ„

```json
{
  "name": "è¿‡æ»¤å™¨åç§°",
  "args": {
    "å‚æ•°å": "å‚æ•°å€¼"
  }
}
```

### å¸¸ç”¨è¿‡æ»¤å™¨ç±»å‹

| è¿‡æ»¤å™¨åç§°               | å‚æ•°                               | è¯´æ˜       |
|---------------------|----------------------------------|----------|
| `StripPrefix`       | `parts`                          | å»é™¤è·¯å¾„å‰ç¼€å±‚æ•° |
| `RewritePath`       | `_genkey_0`ï¼ˆæ­£åˆ™ï¼‰, `_genkey_1`ï¼ˆæ›¿æ¢ï¼‰ | è·¯å¾„é‡å†™     |
| `AddRequestHeader`  | `name`, `value`                  | æ·»åŠ è¯·æ±‚å¤´    |
| `AddResponseHeader` | `name`, `value`                  | æ·»åŠ å“åº”å¤´    |
| `SetStatus`         | `status`                         | è®¾ç½®å“åº”çŠ¶æ€ç   |
| `Retry`             | `retries`, `statuses`            | é‡è¯•é…ç½®     |
| `CircuitBreaker`    | `name`, `fallbackUri`            | ç†”æ–­å™¨      |
| `RateLimiter`       | `replenishRate`, `burstCapacity` | é™æµå™¨      |
| `RequestSize`       | `maxSize`                        | è¯·æ±‚å¤§å°é™åˆ¶   |

### ç¤ºä¾‹

#### StripPrefix è¿‡æ»¤å™¨

```json
{
  "name": "StripPrefix",
  "args": {
    "parts": "1"
  }
}
```

> å»é™¤è¯·æ±‚è·¯å¾„çš„ç¬¬ä¸€æ®µï¼Œå¦‚ `/admin/user/list` â†’ `/user/list`

#### RewritePath è¿‡æ»¤å™¨

```json
{
  "name": "RewritePath",
  "args": {
    "_genkey_0": "/admin/(?<path>.*)",
    "_genkey_1": "/$\\{path}"
  }
}
```

> - `_genkey_0`ï¼šæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…æ¨¡å¼
> - `_genkey_1`ï¼šæ›¿æ¢æ¨¡å¼ï¼ˆ`$\\{path}` åœ¨ JSON ä¸­éœ€è¦è½¬ä¹‰ï¼‰

---

## ğŸ“Š å½“å‰è·¯ç”±é…ç½®ä¸€è§ˆ

| è·¯ç”± ID                  | URI                            | è·¯å¾„æ¨¡å¼                | æƒé‡  | è¯´æ˜               |
|------------------------|--------------------------------|---------------------|-----|------------------|
| `laokou-auth`          | `lb://laokou-auth`             | `/auth/**`          | 100 | è®¤è¯æœåŠ¡             |
| `laokou-admin`         | `lb://laokou-admin`            | `/admin/**`         | 100 | åå°ç®¡ç†æœåŠ¡           |
| `laokou-iot`           | `lb://laokou-iot`              | `/iot/**`           | 100 | IoT æœåŠ¡           |
| `laokou-generator`     | `lb://laokou-generator`        | `/generator/**`     | 100 | ä»£ç ç”ŸæˆæœåŠ¡           |
| `laokou-iot-websocket` | `lb:ws://laokou-iot-websocket` | `/iot-websocket/**` | 100 | IoT WebSocket æœåŠ¡ |

---

## ğŸ“ å®Œæ•´è·¯ç”±é…ç½®ç¤ºä¾‹

### HTTP æœåŠ¡è·¯ç”±

```json
{
  "id": "laokou-admin",
  "uri": "lb://laokou-admin",
  "predicates": [
    {
      "name": "Path",
      "args": {
        "pattern": "/admin/**"
      }
    },
    {
      "name": "Weight",
      "args": {
        "_genkey_0": "admin",
        "_genkey_1": "100"
      }
    }
  ],
  "filters": [
    {
      "name": "StripPrefix",
      "args": {
        "parts": "1"
      }
    },
    {
      "name": "RewritePath",
      "args": {
        "_genkey_0": "/admin/(?<path>.*)",
        "_genkey_1": "/$\\{path}"
      }
    }
  ],
  "metadata": {
    "version": "v1"
  },
  "order": 1
}
```

### WebSocket æœåŠ¡è·¯ç”±

```json
{
  "id": "laokou-iot-websocket",
  "uri": "lb:ws://laokou-iot-websocket",
  "predicates": [
    {
      "name": "Path",
      "args": {
        "pattern": "/iot-websocket/**"
      }
    },
    {
      "name": "Weight",
      "args": {
        "_genkey_0": "iot-websocket",
        "_genkey_1": "100"
      }
    }
  ],
  "filters": [
    {
      "name": "StripPrefix",
      "args": {
        "parts": "1"
      }
    },
    {
      "name": "RewritePath",
      "args": {
        "_genkey_0": "/iot-websocket/(?<path>.*)",
        "_genkey_1": "/$\\{path}"
      }
    }
  ],
  "metadata": {
    "version": "v1"
  },
  "order": 1
}
```

---

## ğŸ”„ è¯·æ±‚è½¬æ¢æµç¨‹

```
å®¢æˆ·ç«¯è¯·æ±‚                    ç½‘å…³å¤„ç†                        åç«¯æœåŠ¡
    â”‚                           â”‚                              â”‚
    â”‚  GET /admin/user/list     â”‚                              â”‚
    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                              â”‚
    â”‚                           â”‚ 1. Path æ–­è¨€åŒ¹é… /admin/**   â”‚
    â”‚                           â”‚ 2. Weight æ–­è¨€éªŒè¯           â”‚
    â”‚                           â”‚ 3. StripPrefix å»é™¤ /admin   â”‚
    â”‚                           â”‚ 4. RewritePath è·¯å¾„é‡å†™      â”‚
    â”‚                           â”‚                              â”‚
    â”‚                           â”‚  GET /user/list              â”‚
    â”‚                           â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
    â”‚                           â”‚                              â”‚
```

---

## ğŸ†• æ–°å¢è·¯ç”±æ¨¡æ¿

å¦‚éœ€æ–°å¢è·¯ç”±ï¼Œå¯å‚è€ƒä»¥ä¸‹æ¨¡æ¿ï¼š

```json
{
  "id": "laokou-xxx",
  "uri": "lb://laokou-xxx",
  "predicates": [
    {
      "name": "Path",
      "args": {
        "pattern": "/xxx/**"
      }
    },
    {
      "name": "Weight",
      "args": {
        "_genkey_0": "xxx",
        "_genkey_1": "100"
      }
    }
  ],
  "filters": [
    {
      "name": "StripPrefix",
      "args": {
        "parts": "1"
      }
    },
    {
      "name": "RewritePath",
      "args": {
        "_genkey_0": "/xxx/(?<path>.*)",
        "_genkey_1": "/$\\{path}"
      }
    }
  ],
  "metadata": {
    "version": "v1"
  },
  "order": 1
}
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **è·¯ç”± ID å”¯ä¸€æ€§**ï¼šæ¯ä¸ªè·¯ç”±çš„ `id` å¿…é¡»å”¯ä¸€
2. **è·¯å¾„åŒ¹é…é¡ºåº**ï¼š`order` å€¼è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜
3. **JSON è½¬ä¹‰**ï¼š`$\\{path}` åœ¨ JSON ä¸­éœ€è¦åŒåæ–œæ è½¬ä¹‰
4. **WebSocket è·¯ç”±**ï¼šä½¿ç”¨ `lb:ws://` åè®®å‰ç¼€
5. **æƒé‡é…ç½®**ï¼šåŒä¸€åˆ†ç»„çš„æƒé‡æ€»å’Œå»ºè®®ä¸º 100
6. **æœåŠ¡åç§°**ï¼š`uri` ä¸­çš„æœåŠ¡åéœ€ä¸ Nacos æ³¨å†Œçš„æœåŠ¡åä¸€è‡´

æˆ‘æ˜¯è€å¯‡ï¼Œæˆ‘ä»¬ä¸‹æ¬¡å†è§å•¦ï¼
