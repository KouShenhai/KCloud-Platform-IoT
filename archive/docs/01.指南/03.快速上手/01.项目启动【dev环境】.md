---
title: é¡¹ç›®å¯åŠ¨ã€devç¯å¢ƒã€‘
date: 2023-09-26 12:20:19
permalink: /pages/10bfa7/
---

ä½ å¥½å‘€ï¼Œæˆ‘çš„è€æœ‹å‹ï¼æˆ‘æ˜¯è€å¯‡ï¼Œæ¬¢è¿æ¥åˆ°è€å¯‡äº‘å¹³å°ï¼

## ç¯å¢ƒæ­å»º

ä¿®æ”¹winç³»ç»Ÿä¸Šé¢çš„hosts(å¦‚æœ‰éœ€è¦ï¼Œè¯·è‡ªè¡Œæ›´æ¢IP)ã€ç›®å½•ä½ç½®ï¼šC:\Windows\System32\drivers\etc\hostsã€‘



```shell
127.0.0.1 rocketmq-namesrv
127.0.0.1 redis
127.0.0.1 postgresql
127.0.0.1 nginx
127.0.0.1 elasticsearch
127.0.0.1 nacos
127.0.0.1 kafka
127.0.0.1 sentinel
127.0.0.1 gateway
127.0.0.1 tdengine
127.0.0.1 job
127.0.0.1 auth
127.0.0.1 admin
127.0.0.1 jaeger-collector
127.0.0.1 otel-collector
127.0.0.1 ui
127.0.0.1 arthas-server
127.0.0.1 seata
127.0.0.1 loki
127.0.0.1 react
```

```shell
services:
  postgresql:
    image: timescale/timescaledb:latest-pg17
    container_name: postgresql
    # ä¿æŒå®¹å™¨åœ¨æ²¡æœ‰å®ˆæŠ¤ç¨‹åºçš„æƒ…å†µä¸‹è¿è¡Œ
    tty: true
    restart: always
    privileged: true
    ports:
      - "5432:5432"
    volumes:
      - ./postgresql17/data:/var/lib/postgresql/data
    environment:
      - POSTGRES_USER=root
      - POSTGRES_PASSWORD=laokou123
      - TZ=Asia/Shanghai
    networks:
      - laokou_network
  redis:
    image: redis:7.4.2
    container_name: redis
    # ä¿æŒå®¹å™¨åœ¨æ²¡æœ‰å®ˆæŠ¤ç¨‹åºçš„æƒ…å†µä¸‹è¿è¡Œ
    tty: true
    restart: always
    privileged: true
    ports:
      - "6379:6379"
    volumes:
      - ./redis7/conf/redis.conf:/etc/redis/redis.conf
      - ./redis7/data:/data
    command: redis-server --appendonly yes --requirepass 'laokou123'
    environment:
      - TZ=Asia/Shanghai
    networks:
      - laokou_network
  rocketmq-namesrv:
    image: apache/rocketmq:5.3.1
    container_name: rocketmq-namesrv
    # ä¿æŒå®¹å™¨åœ¨æ²¡æœ‰å®ˆæŠ¤ç¨‹åºçš„æƒ…å†µä¸‹è¿è¡Œ
    tty: true
    restart: always
    privileged: true
    ports:
      - "9876:9876"
    command: sh mqnamesrv
    environment:
      - JAVA_OPT_EXT=-server -Xmx512m -Xms512m -Xmn256m
      - TZ=Asia/Shanghai
    networks:
      - laokou_network
  rocketmq-broker:
    image: apache/rocketmq:5.3.1
    container_name: rocketmq-broker
    # ä¿æŒå®¹å™¨åœ¨æ²¡æœ‰å®ˆæŠ¤ç¨‹åºçš„æƒ…å†µä¸‹è¿è¡Œ
    tty: true
    restart: always
    privileged: true
    ports:
      - "10909:10909"
      - "10911:10911"
      - "10912:10912"
    # è‡ªåŠ¨åˆ›å»ºä¸»é¢˜
    command: sh mqbroker -n rocketmq-namesrv:9876 -c /home/rocketmq/conf/broker.conf autoCreateTopicEnable=true
    environment:
      - JAVA_OPT_EXT=-server -Xmx512m -Xms512m -Xmn256m
      - TZ=Asia/Shanghai
    volumes:
      - ./rocketmq5/broker/conf/broker.conf:/home/rocketmq/conf/broker.conf
      # æŒ‚è½½æ•°æ®
      - ./rocketmq5/broker/store:/home/rocketmq/store
      # æŒ‚è½½æ—¥å¿—
      - ./rocketmq5/broker/logs:/home/rocketmq/logs
    networks:
      - laokou_network
    depends_on:
      - rocketmq-namesrv
networks:
  laokou_network:
    driver: bridge
```

## è§†é¢‘åœ°å€

[è€å¯‡äº‘å¹³å°-é¡¹ç›®æ¼”ç¤ºè§†é¢‘](https://www.bilibili.com/video/BV16M411C7v7)

## é¡¹ç›®è¿è¡Œï¼ˆè¯·ä¸€å®šæŒ‰ç…§ä½œè€…çš„æ­¥éª¤æ¥ï¼‰

ğŸš€ æ³¨æ„ï¼šä¹‹å‰åˆ›å»ºçš„æ•°æ®åº“ç»Ÿç»Ÿåˆ æ‰ï¼ˆä¸è¯¥é¡¹ç›®ç›¸å…³çš„æ•°æ®åº“ï¼‰

ğŸš€ è½¯ä»¶ç‰ˆæœ¬
<table>
    <tr>
        <th>è½¯ä»¶åç§°</th>
        <th>è½¯ä»¶ç‰ˆæœ¬</th>
    </tr>
    <tr>
        <td>JDK</td>
        <td>21</td>
    </tr>
    <tr>
        <td>Maven</td>
        <td>3.9.4</td>
    </tr>
    <tr>
        <td>TimescaleDB</td>
        <td>17</td>
    </tr>
    <tr>
        <td>Redis</td>
        <td>7.2.0+</td>
    </tr>
    <tr>
        <td>RocketMQ</td>
        <td>5.3.0+</td>
    </tr>
</table>

ğŸš€ ä¿®æ”¹winç³»ç»Ÿä¸Šé¢çš„hosts(å¦‚æœ‰éœ€è¦ï¼Œè¯·è‡ªè¡Œæ›´æ¢IP)

```shell
127.0.0.1 react
127.0.0.1 tdengine
127.0.0.1 emqx
127.0.0.1 rocketmq-namesrv
127.0.0.1 redis
127.0.0.1 elasticsearch
127.0.0.1 postgresql
127.0.0.1 nginx
127.0.0.1 register
127.0.0.1 kafka
127.0.0.1 job
127.0.0.1 sentinel
127.0.0.1 gateway
127.0.0.1 nacos
127.0.0.1 auth
127.0.0.1 admin
127.0.0.1 jaeger-collector
```

<font color="red">è´¦å·</font>

| ç”¨æˆ·å    | å¯†ç        | ç§Ÿæˆ·    | è¶…çº§ç®¡ç†å‘˜ |
|--------|----------|-------|-------|
| admin  | admin123 | è€å¯‡äº‘é›†å›¢ | æ˜¯     |
| test   | test123  | è€å¯‡äº‘é›†å›¢ | å¦     |
| laok5  | test123  | è€å¯‡äº‘é›†å›¢ | å¦     |
| wumh5  | test123  | è€å¯‡äº‘é›†å›¢ | å¦     |
| koush5 | test123  | è€å¯‡äº‘é›†å›¢ | å¦     |

ğŸš€ é¡¹ç›®æ‹‰å–ï¼ˆå®‰è£…gitï¼‰

sshæ–¹å¼æ‹‰å–ï¼ˆæ¨èï¼‰

```shell
git clone git@github.com:KouShenhai/KCloud-Platform-IoT.git
```

httpsæ–¹å¼

```shell
git clone https://github.com/KouShenhai/KCloud-Platform-IoT.git
```

ğŸš€ é¡¹ç›®æ‰“åŒ…ï¼Œç¡®ä¿é¡¹ç›®èƒ½æ­£å¸¸ç¼–è¯‘(å…ˆåœ¨testç¯å¢ƒèƒ½æ­£å¸¸æ‰“åŒ…ï¼Œç”Ÿäº§ç¯å¢ƒéœ€è¦prodï¼Œé»˜è®¤ä½¿ç”¨mavenæ’ä»¶è·³è¿‡æµ‹è¯•ç”¨ä¾‹)

<font color="red">æ³¨æ„ï¼šé¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰§è¡Œï¼ˆæ¨ètestç¯å¢ƒï¼Œdevæ˜¯httpï¼Œtestæ˜¯httpsï¼Œprodæ˜¯https+kafkaåˆ†å¸ƒå¼é“¾è·¯ï¼‰</font>

```shell
mvn clean install -P test
```

ğŸš€ å¯åŠ¨Postgresqlã€Redisã€RocketMQå’ŒElasticsearch

ğŸš€ åˆå§‹åŒ–æ•°æ®åº“
<img src="/img/5/img_21.png"/>

ğŸš€ ä¿®æ”¹pom.xmlé…ç½®ï¼Œä¿®æ”¹æ•°æ®åº“è¿æ¥ä¿¡æ¯ï¼Œå…¶ä»–ä¿¡æ¯é»˜è®¤å³å¯
<img src="/img/5/img_23.png"/>

ğŸš€ å¿…é¡»è¿è¡Œlaokou-nacosï¼Œå¯åŠ¨å•æœºNacosï¼ˆéœ€è¦é…ç½®VM Optionï¼‰
<img src="/img/5/img_5.png"/>

<font color="red">nacoså¼€å¯grpc tlsè®¤è¯ï¼Œéœ€è¦å¢åŠ å¦‚ä¸‹å‚æ•°</font>

```shell
-Xmx256m
-Xms256m
-Dnacos.standalone=true
-Dnacos.home=./logs
-Dnacos.remote.server.rpc.tls.enableTls=true
-Dnacos.remote.server.rpc.tls.mutualAuthEnable=true
-Dnacos.remote.server.rpc.tls.compatibility=false
-Dnacos.remote.server.rpc.tls.certChainFile=nacos-server-cert.pem
-Dnacos.remote.server.rpc.tls.certPrivateKey=nacos-server-key.pem
-Dnacos.remote.server.rpc.tls.trustCollectionCertFile=nacos-ca-cert.pem
-Dnacos.remote.server.rpc.tls.certPrivateKeyPassword=laokou123
--add-opens=java.base/java.lang=ALL-UNNAMED
```

<img src="/img/5/img_6.png"/>

ğŸš€ æ‰“å¼€Nacosæ§åˆ¶å°ï¼Œåˆ›å»ºå‘½åç©ºé—´ï¼ˆå¦‚æœ‰éœ€è¦è‡ªè¡Œä¿®æ”¹å³å¯ï¼‰
<img src="/img/5/img_7.png"/>

ğŸš€ æé†’ï¼šæ¯ä¸ªæ³¨å†Œnacosçš„æœåŠ¡éƒ½éœ€è¦åœ¨vm optionå¢åŠ å‚æ•°ã€å¼€å¯nacos grpc tlsè®¤è¯ï¼Œéœ€è¦å¢åŠ å¦‚ä¸‹å‚æ•°ã€‘

```shell
-Xms512m
-Xmx512m
-Dlog4j.skipJansi=false
-Dnacos.remote.client.rpc.tls.enable=true
-Dnacos.remote.client.rpc.tls.mutualAuth=true
-Dnacos.remote.client.rpc.tls.certChainFile=nacos-client-cert.pem
-Dnacos.remote.client.rpc.tls.certPrivateKey=nacos-client-key.pem
-Dnacos.remote.client.rpc.tls.trustCollectionChainPath=nacos-ca-cert.pem
-Dnacos.remote.client.rpc.tls.certPrivateKeyPassword=laokou123
-Dserver.port=æŒ‡å®šç«¯å£
# æ³¨æ„ï¼šé›†æˆsentinelï¼Œè¿˜éœ€è¦æŒ‡å®šé€šè®¯ç«¯å£ï¼Œ8722å¾€åç´¯è®¡å³å¯ï¼Œç«¯å£ä¸èƒ½é‡å¤ï¼Œä¸”ä¸èƒ½å’Œå…¶ä»–æœåŠ¡æœ‰å†²çª
-Dcsp.sentinel.api.port=æŒ‡å®šç«¯å£
```

<img src="/img/5/img_30.png"/>

ğŸš€ ä¾æ¬¡è¿è¡Œlaokou-snail-jobã€ laokou-gatewayã€laokou-adminã€laokou-authï¼ˆå¿…é¡»è¿è¡Œï¼‰

ğŸš€ è¿è¡Œå®Œlaokou-gateawy éœ€è¦è¿è¡Œè·¯ç”±åŒæ­¥è„šæœ¬
<img src="/img/5/img_2.png"/>
<img src="/img/5/img_28.png"/>

ğŸš€ æŒ‰éœ€è¦è¿è¡Œlaokou-monitorï¼ˆä¸ä½¿ç”¨æœåŠ¡ç›‘æ§å¯ä»¥ä¸å¯åŠ¨ï¼‰ï¼Œè¿˜æœ‰å°±æ˜¯åˆ«ç”¨è€å¤«çš„é‚®ç®±ï¼Œæ±‚æ±‚ä½ ä»¬æ”¹ä¸€æ”¹å§
<img src="/img/5/img_25.png"/>

ğŸš€ æŒ‰éœ€è¦è¿è¡Œlaokou-sentinelï¼ˆä¸ä½¿ç”¨æµé‡ç›‘æ§å¯ä»¥ä¸å¯åŠ¨ï¼‰
<img src="/img/5/img_26.png"/>

## å¸¸è§é—®é¢˜

### 1.vueå¼€å¯websocketï¼Œwssåè®®æ— æ³•å»ºç«‹è¿æ¥

è§£å†³æ–¹æ¡ˆè§ [è‡ªç­¾åè¯ä¹¦å®‰è£…æµè§ˆå™¨](/pages/10bfa8/#åˆ›å»ºè¯ä¹¦-å¸¦åŸŸå)

### 2.é˜¿é‡Œä»“åº“æ— æ³•ä¸‹è½½æœ€æ–°jar

ä¿®æ”¹ maven/conf/setting.xml é…ç½®

```xml

<mirrors>
	<mirror>
		<id>alimaven</id>
		<mirrorOf>central</mirrorOf>
		<name>aliyun maven</name>
		<url>https://maven.aliyun.com/nexus/content/repositories/central/</url>
	</mirror>
</mirrors>
```

### 3.å¦‚ä½•ç”ŸæˆæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯è¯ä¹¦

è§£å†³æ–¹æ¡ˆè§ [æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯è¯ä¹¦](/pages/10bfa8/#æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯è¯ä¹¦)

æˆ‘æ˜¯è€å¯‡ï¼Œæˆ‘ä»¬ä¸‹æ¬¡å†è§å•¦ï¼
