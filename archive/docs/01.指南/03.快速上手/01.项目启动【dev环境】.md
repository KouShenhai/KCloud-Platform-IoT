---
title: é¡¹ç›®å¯åŠ¨ã€devç¯å¢ƒã€‘
date: 2023-09-26 12:20:19
permalink: /pages/10bfa7/
---

ä½ å¥½å‘€ï¼Œæˆ‘çš„è€æœ‹å‹ï¼æˆ‘æ˜¯è€å¯‡ï¼Œæ¬¢è¿æ¥åˆ°è€å¯‡äº‘å¹³å°ï¼

## ç¯å¢ƒæ­å»º

ä¿®æ”¹winç³»ç»Ÿä¸Šé¢çš„hosts(<font color="red">å¦‚æœ‰éœ€è¦ï¼Œè¯·è‡ªè¡Œæ›´æ¢IPï¼Œæ¯”å¦‚è¯´ä½¿ç”¨äº‘æœåŠ¡ï¼Œè¯·æ›´æ¢æˆäº‘æœåŠ¡å™¨IP</font>)ã€ç›®å½•ä½ç½®ï¼š<font color="red">C:\Windows\System32\drivers\etc\hosts</font>ã€‘

```shell
127.0.0.1 kafka
127.0.0.1 redis
127.0.0.1 postgresql
127.0.0.1 nginx
127.0.0.1 elasticsearch
127.0.0.1 nacos
127.0.0.1 gateway
127.0.0.1 tdengine
127.0.0.1 snail-job
127.0.0.1 auth
127.0.0.1 admin
127.0.0.1 jaeger-collector
127.0.0.1 otel-collector
127.0.0.1 ui
127.0.0.1 iot
127.0.0.1 loki
127.0.0.1 jaeger-query
127.0.0.1 pulsar
127.0.0.1 sentinel
127.0.0.1 zookeeper
```

[windowå®‰è£…dockeræ•™ç¨‹](https://kcloud.blog.csdn.net/article/details/123039609)

æ³¨æ„ï¼š<font color="red">æœ¬æ•™ç¨‹ä¸ºwindowç³»ç»Ÿçš„dockerï¼Œå…¶ä½™ç¯å¢ƒè¯·è‡ªè¡Œå®‰è£…</font>

æ³¨æ„ï¼š<font color="red">windowç³»ç»Ÿè‡ªå¸¦docker-composeï¼Œæ— éœ€å®‰è£…</font>

æ³¨æ„ï¼š<font color="red">å…ˆè·‘èµ·æ¥ï¼Œä¸è¦æ”¹ä»»ä½•çš„å¯†ç ï¼Œè¯·ä¸è¦æ“…ä½œä¸»å¼ çš„ä¿®æ”¹ï¼Œå¦‚æœç…§ç€æ•™ç¨‹è¿è¡Œï¼Œè¿˜æœ‰é—®é¢˜è¯·è”ç³»ä½œè€…</font>

æ³¨æ„ï¼š<font color="red">æœ¬æ•™ç¨‹ä¸ºwindowç³»ç»Ÿçš„dockerï¼Œå…¶ä½™ç¯å¢ƒè¯·è‡ªè¡Œå®‰è£…</font>

```shell
services:
  postgresql:
    image: timescale/timescaledb:latest-pg17
    container_name: postgresql
    # ä¿æŒå®¹å™¨åœ¨æ²¡æœ‰å®ˆæŠ¤ç¨‹åºçš„æƒ…å†µä¸‹è¿è¡Œ
    tty: true
    restart: always
    privileged: true
    ports:
      - "5432:5432"
    volumes:
      - ./postgresql17/data:/var/lib/postgresql/data
    environment:
      - POSTGRES_USER=root
      - POSTGRES_PASSWORD=laokou123
      - TZ=Asia/Shanghai
    networks:
      - iot_network
  redis:
    image: redis:8.0.1
    container_name: redis
    # ä¿æŒå®¹å™¨åœ¨æ²¡æœ‰å®ˆæŠ¤ç¨‹åºçš„æƒ…å†µä¸‹è¿è¡Œ
    tty: true
    restart: always
    privileged: true
    ports:
      - "6379:6379"
    volumes:
      - ./redis7/conf/redis.conf:/etc/redis/redis.conf
      - ./redis7/data:/data
    command: redis-server --appendonly yes --requirepass 'laokou123'
    environment:
      - TZ=Asia/Shanghai
    networks:
      - iot_network
  kafka:
    image: bitnami/kafka:4.0.0
    container_name: kafka
    tty: true
    ports:
      - '9092:9092'
      - '9093:9093'
    environment:
      # èŠ‚ç‚¹ID
      - KAFKA_BROKER_ID=1
      # å…è®¸ä½¿ç”¨kraftï¼Œå³Kafkaæ›¿ä»£Zookeeper
      - KAFKA_ENABLE_KRAFT=yes
      # kafkaè§’è‰²ï¼Œåšbrokerï¼Œä¹Ÿè¦åšcontroller
      - KAFKA_CFG_PROCESS_ROLES=broker,controller
      # æŒ‡å®šä¾›å¤–éƒ¨ä½¿ç”¨çš„æ§åˆ¶ç±»è¯·æ±‚ä¿¡æ¯
      - KAFKA_CFG_CONTROLLER_LISTENER_NAMES=CONTROLLER
      # å®šä¹‰å®‰å…¨åè®®
      - KAFKA_CFG_LISTENER_SECURITY_PROTOCOL_MAP=CONTROLLER:PLAINTEXT,PLAINTEXT:PLAINTEXT
      # å®šä¹‰kafkaæœåŠ¡ç«¯socketç›‘å¬ç«¯å£
      - KAFKA_CFG_LISTENERS=PLAINTEXT://:9092,CONTROLLER://:9093
      # å¤–ç½‘è®¿é—®åœ°å€
      - KAFKA_CFG_ADVERTISED_LISTENERS=PLAINTEXT://kafka:9092
      # å…è®¸ä½¿ç”¨PLAINTEXTç›‘å¬å™¨ï¼Œé»˜è®¤falseï¼Œä¸å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨
      - ALLOW_PLAINTEXT_LISTENER=yes
      # è®¾ç½®brokeræœ€å¤§å†…å­˜ï¼Œå’Œåˆå§‹å†…å­˜
      - KAFKA_HEAP_OPTS=-Xmx512M -Xms512M
      # é›†ç¾¤åœ°å€
      - KAFKA_CFG_CONTROLLER_QUORUM_VOTERS=1@kafka:9093
      # èŠ‚ç‚¹ID
      - KAFKA_CFG_NODE_ID=1
    restart: always
    privileged: true
    networks:
      - iot_network
  # bin/pulsar-admin tenants create laokou
  # bin/pulsar-admin namespaces create laokou/mqtt
  # bin/pulsar-admin topics create-partitioned-topic laokou/mqtt/up-property-report -p 4
  # bin/pulsar-admin topics create-partitioned-topic laokou/mqtt/down-property-read -p 4
  # bin/pulsar-admin topics create-partitioned-topic laokou/mqtt/up-property-read-reply -p 4
  # bin/pulsar-admin topics create-partitioned-topic laokou/mqtt/down-property-write -p 4
  # bin/pulsar-admin topics create-partitioned-topic laokou/mqtt/up-property-write-reply -p 4
  pulsar:
    image: apachepulsar/pulsar:4.0.5
    container_name: pulsar
    # ä¿æŒå®¹å™¨åœ¨æ²¡æœ‰å®ˆæŠ¤ç¨‹åºçš„æƒ…å†µä¸‹è¿è¡Œ
    tty: true
    restart: always
    privileged: true
    command: bin/pulsar standalone
    environment:
      - PULSAR_MEM=-Xms512m -Xmx512m
    ports:
      - "6650:6650"
      - "8080:8080"
    volumes:
      - ./pulsar/data:/pulsar/data
    networks:
      - iot_network
  zookeeper:
    image: bitnami/zookeeper:3.9.3
    container_name: zookeeper
    tty: true
    ports:
      - '2181:2181'
    environment:
      # å…è®¸åŒ¿åç™»å½•
      - ALLOW_ANONYMOUS_LOGIN=yes
    restart: always
    privileged: true
    networks:
      - iot_network
  # https://github.com/KouShenhai/Sentinel
  # è´¦å·/å¯†ç  => sentinel/laokou123
  sentinel-dashboard:
    image: registry.cn-shenzhen.aliyuncs.com/koushenhai/sentinel-dashboard:4.0.0
    container_name: sentinel-dashboard
    # ä¿æŒå®¹å™¨åœ¨æ²¡æœ‰å®ˆæŠ¤ç¨‹åºçš„æƒ…å†µä¸‹è¿è¡Œ
    tty: true
    restart: always
    privileged: true
    ports:
      - "8972:8972"
    volumes:
      - ./sentinel/logs:/opt/logs/csp
    env_file:
      - env/sentinel.env
    networks:
      - iot_network
  snail-job:
    image: registry.cn-shenzhen.aliyuncs.com/koushenhai/snail-job:4.0.0
    container_name: snail-job
    # ä¿æŒå®¹å™¨åœ¨æ²¡æœ‰å®ˆæŠ¤ç¨‹åºçš„æƒ…å†µä¸‹è¿è¡Œ
    tty: true
    restart: always
    privileged: true
    ports:
      - "8088:8088"
      - "17888:17888"
    volumes:
      - ./snail-job/logs:/opt/data/log
    env_file:
      - env/snail-job.env
    networks:
      - iot_network
    depends_on:
      - postgresql
  portainer:
    image: portainer/portainer-ce:latest
    container_name: portainer
    # ä¿æŒå®¹å™¨åœ¨æ²¡æœ‰å®ˆæŠ¤ç¨‹åºçš„æƒ…å†µä¸‹è¿è¡Œ
    tty: true
    restart: always
    privileged: true
    ports:
      - "9010:9000"
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - ./portainer/data:/data
    networks:
      - iot_network
networks:
  iot_network:
    driver: bridge
```

å¢åŠ sentinel.envé…ç½®

<font color="red">è¯·æ³¨æ„sentinelè·¯å¾„</font>

<font color="red">è¯·æ³¨æ„sentinelè·¯å¾„</font>

<font color="red">è¯·æ³¨æ„sentinelè·¯å¾„</font>

```shell
AUTH_USERNAME=sentinel
AUTH_PASSWORD=laokou123
VERSION=4.0.0
PROFILE=dev
SERVER_PORT=8972
JVM_OPTS="-Xmx512m -Xms512m -Xmn256m -XX:+UseCompactObjectHeaders -XX:+UseG1GC -Duser.timezone=GMT+08"
```

å¢åŠ snail-job.envé…ç½®

<font color="red">è¯·æ³¨æ„snail-jobè·¯å¾„</font>

<font color="red">è¯·æ³¨æ„snail-jobè·¯å¾„</font>

<font color="red">è¯·æ³¨æ„snail-jobè·¯å¾„</font>

```shell
DS_DRIVER=org.postgresql.Driver
DS_HOST=postgresql
DS_PORT=5432
DATASOURCE_DATABASE=snail_job
DATASOURCE_PARAM=tcpKeepAlive=true&reWriteBatchedInserts=true&ApplicationName=snail-job&useSSL=false&reWriteBatchedInserts=true&stringtype=unspecified
DS_PLATFORM=postgresql
DATASOURCE_USERNAME=root
DATASOURCE_PASSWORD=laokou123
PROFILE=dev
SERVER_PORT=8088
TZ=Asia/Shanghai
LANG=zh_CN.UTF-8
```

æ³¨æ„ï¼š<font color="red">å¤åˆ¶åˆ°æŒ‡å®šç›®å½•ï¼Œç„¶åå¯åŠ¨æœåŠ¡ã€éœ€è¦æˆæƒã€‘</font>

```shell
# Ubuntuæˆæƒ
chmod -R 7777 ç›®å½•
```

```shell
# å¯åŠ¨æœåŠ¡
docker-compose up - d
```

è®¿é—®ã€dockerå¯è§†åŒ–ç•Œé¢ã€‘http://localhost:9010

æ³¨æ„ï¼š<font color="red">å›¾ç‰‡ä»…ä¾›å‚è€ƒï¼Œä»¥å®é™…ç›®å½•ä¸ºå‡†</font>

<img src="/img/é¡¹ç›®å¯åŠ¨ã€devç¯å¢ƒã€‘/img_13.png">

<img src="/img/é¡¹ç›®å¯åŠ¨ã€devç¯å¢ƒã€‘/img_14.png">

## è§†é¢‘åœ°å€

æ³¨æ„ï¼š<font color="red">è§†é¢‘ä»…ä¾›å‚è€ƒï¼Œä»¥å®é™…é¡¹ç›®ä¸ºå‡†</font>

[è€å¯‡äº‘å¹³å°-é¡¹ç›®æ¼”ç¤ºè§†é¢‘](https://www.bilibili.com/video/BV16M411C7v7)

## é¡¹ç›®è¿è¡Œï¼ˆè¯·ä¸€å®šæŒ‰ç…§ä½œè€…çš„æ­¥éª¤æ¥ï¼‰

æ³¨æ„ï¼š<font color="red">Maven ç‰ˆæœ¬è¯·ä½¿ç”¨3.9.x</font>

æ³¨æ„ï¼š<font color="red">Maven ç‰ˆæœ¬è¯·ä½¿ç”¨3.9.x</font>

æ³¨æ„ï¼š<font color="red">Maven ç‰ˆæœ¬è¯·ä½¿ç”¨3.9.x</font>

<font color="red">æ³¨æ„ï¼šé¡¹ç›®é‡Œé¢å·²ç»é…ç½®ï¼Œå¦‚æœè¿˜æ˜¯ä¸‹è½½ä¸äº†ä¾èµ–ï¼Œå¯ä»¥å°è¯•é…ç½®Maven setting.xml</font>

```xml
<mirrors>
	<mirror>
		<id>nexus</id>
		<mirrorOf>*,!spring-milestones,!spring-snapshots</mirrorOf>
		<url>https://mirrors.cloud.tencent.com/nexus/repository/maven-public/</url>
	</mirror>
</mirrors>
```

ğŸš€ è½¯ä»¶ç‰ˆæœ¬
<table>
    <tr>
        <th>è½¯ä»¶åç§°</th>
        <th>è½¯ä»¶ç‰ˆæœ¬</th>
    </tr>
    <tr>
        <td>JDK</td>
        <td>25</td>
    </tr>
    <tr>
        <td>Maven</td>
        <td>3.9.11</td>
    </tr>
    <tr>
        <td>TimescaleDB</td>
        <td>17</td>
    </tr>
    <tr>
        <td>Redis</td>
        <td>7.2.4</td>
    </tr>
</table>

ğŸš€ é¡¹ç›®æ‹‰å–ï¼ˆå®‰è£…gitï¼‰

- é¡¹ç›®ç›®å½•é‡Œé¢ä¸èƒ½å¸¦ä¸­æ–‡
- é¡¹ç›®ç›®å½•é‡Œé¢ä¸èƒ½å¸¦ä¸­æ–‡
- é¡¹ç›®ç›®å½•é‡Œé¢ä¸èƒ½å¸¦ä¸­æ–‡

sshæ–¹å¼æ‹‰å–ï¼ˆæ¨èï¼‰

```shell
git clone git@github.com:KouShenhai/KCloud-Platform-IoT.git
```

httpsæ–¹å¼

```shell
git clone https://github.com/KouShenhai/KCloud-Platform-IoT.git
```

ğŸš€ é¡¹ç›®æ‰“åŒ…ï¼Œç¡®ä¿é¡¹ç›®èƒ½æ­£å¸¸ç¼–è¯‘

```shell
# é¡¹ç›®æ‰“åŒ…
mvn clean install -P dev -DskipTests
```

ğŸš€ åˆå§‹åŒ–æ•°æ®åº“
- kcloud_platform.sql ã€ç³»ç»Ÿç®¡ç†ã€‘
- kcloud_platform_domain.sql ã€é¢†åŸŸäº‹ä»¶ã€‘
- kcloud_platform_iot.sql ã€ç‰©è”ç®¡ç†ã€‘
- kcloud_platform_nacos.sql ã€Nacosã€‘
- kcloud_platform_generator.sql ã€ä»£ç ç”Ÿæˆã€‘

æ³¨æ„ï¼š<font color="red">å›¾ç‰‡ä»…ä¾›å‚è€ƒï¼Œä»¥å®é™…ç›®å½•ä¸ºå‡†</font>

<img src="/img/é¡¹ç›®å¯åŠ¨ã€devç¯å¢ƒã€‘/img_2.png">

æ³¨æ„ï¼š<font color="red">ä¸åŒçš„æ•°æ®åº“æ‰§è¡Œä¸åŒçš„SQLæ–‡ä»¶ </font>

æ³¨æ„ï¼š<font color="red">ä¸åŒçš„æ•°æ®åº“æ‰§è¡Œä¸åŒçš„SQLæ–‡ä»¶ </font>

æ³¨æ„ï¼š<font color="red">ä¸åŒçš„æ•°æ®åº“æ‰§è¡Œä¸åŒçš„SQLæ–‡ä»¶ </font>

ğŸš€ ä¿®æ”¹pom.xmlé…ç½®ï¼Œä¿®æ”¹æ•°æ®åº“è¿æ¥ä¿¡æ¯ï¼Œå…¶ä»–ä¿¡æ¯é»˜è®¤å³å¯

æ³¨æ„ï¼š<font color="red">å…ˆè·‘èµ·æ¥ï¼Œä¸è¦æ”¹ä»»ä½•çš„å¯†ç ï¼Œè¯·ä¸è¦æ“…ä½œä¸»å¼ çš„ä¿®æ”¹ï¼Œå¦‚æœç…§ç€æ•™ç¨‹è¿è¡Œï¼Œè¿˜æœ‰é—®é¢˜è¯·è”ç³»ä½œè€…</font>

æ³¨æ„ï¼š<font color="red">å›¾ç‰‡ä»…ä¾›å‚è€ƒï¼Œä»¥å®é™…ç›®å½•ä¸ºå‡†</font>

<img src="/img/é¡¹ç›®å¯åŠ¨ã€devç¯å¢ƒã€‘/img_3.png">

ğŸš€ è¿è¡Œlaokou-nacosï¼Œå¯åŠ¨å•æœºNacosï¼ˆéœ€è¦é…ç½®VM Optionï¼‰ã€è¿è¡Œå¥½äº†ï¼Œä¸è¦å…³é—­nacosã€‘

<img src="/img/é¡¹ç›®å¯åŠ¨ã€devç¯å¢ƒã€‘/img_4.png">

```shell
-Xmx512m
-Xms512m
-Dnacos.standalone=true
-Dcom.google.protobuf.use_unsafe_pre22_gencode
```

<img src="/img/é¡¹ç›®å¯åŠ¨ã€devç¯å¢ƒã€‘/img_5.png">

ğŸš€ è®¿é—® <a href='http://localhost:8848/nacos'>Nacosæ§åˆ¶å°</a>ï¼Œåˆ›å»ºå‘½åç©ºé—´ï¼ˆå¦‚æœ‰éœ€è¦è‡ªè¡Œä¿®æ”¹å³å¯ï¼‰

<img src="/img/é¡¹ç›®å¯åŠ¨ã€devç¯å¢ƒã€‘/img_6.png">

<img src="/img/é¡¹ç›®å¯åŠ¨ã€devç¯å¢ƒã€‘/img_7.png">

ğŸš€ <font color="red">æ³¨æ„ï¼šè¯·è¿è¡Œlaokou-nacosã€laokou-distributed-identifierã€laokou-ossã€laokou-authã€laokou-gatewayã€laokou-adminã€æœ‰å…ˆåé¡ºåºï¼Œè¯·æŒ‰ç…§æ­¥éª¤ã€‘</font>

ğŸš€ <font color="red">æ³¨æ„ï¼šè¯·è¿è¡Œlaokou-nacosã€laokou-distributed-identifierã€laokou-ossã€laokou-authã€laokou-gatewayã€laokou-adminã€æœ‰å…ˆåé¡ºåºï¼Œè¯·æŒ‰ç…§æ­¥éª¤ã€‘</font>

ğŸš€ <font color="red">æ³¨æ„ï¼šè¯·è¿è¡Œlaokou-nacosã€laokou-distributed-identifierã€laokou-ossã€laokou-authã€laokou-gatewayã€laokou-adminã€æœ‰å…ˆåé¡ºåºï¼Œè¯·æŒ‰ç…§æ­¥éª¤ã€‘</font>

æ³¨æ„ï¼š<font color="red">å›¾ç‰‡ä»…ä¾›å‚è€ƒï¼Œä»¥å®é™…ç›®å½•ä¸ºå‡†</font>

<img src="/img/é¡¹ç›®å¯åŠ¨ã€devç¯å¢ƒã€‘/img_8.png">

<img src="/img/é¡¹ç›®å¯åŠ¨ã€devç¯å¢ƒã€‘/img_9.png">

<img src="/img/é¡¹ç›®å¯åŠ¨ã€devç¯å¢ƒã€‘/img_10.png">

ğŸš€ è®¿é—®APIæ–‡æ¡£

ç½‘å…³æœåŠ¡ï¼šhttp://gateway:5555/doc.html

è®¤è¯æœåŠ¡ï¼šhttp://auth:1111/doc.html

ç®¡ç†æœåŠ¡ï¼šhttp://admin:9990/doc.html

<img src="/img/é¡¹ç›®å¯åŠ¨ã€devç¯å¢ƒã€‘/img_12.png">

æˆ‘æ˜¯è€å¯‡ï¼Œæˆ‘ä»¬ä¸‹æ¬¡å†è§å•¦ï¼
