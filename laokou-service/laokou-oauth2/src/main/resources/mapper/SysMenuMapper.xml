<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="io.laokou.oauth2.mapper.SysMenuMapper">
    <select id="getPermissionsList" resultType="string" flushCache="true">
        SELECT DISTINCT substring_index(substring_index(permissions,',',help_topic_id + 1),',','-1') as permissions FROM boot_sys_menu
        left join mysql.help_topic on 1 = 1
        where help_topic_id &lt; length(permissions) - length(replace(permissions,',','')) + 1
        order by update_date desc
    </select>

    <select id="getPermissionsListByUserId" resultType="string" flushCache="true">
        SELECT DISTINCT substring_index(substring_index(permissions,',',help_topic_id + 1),',','-1') as permissions FROM boot_sys_menu
        ,boot_sys_role
        ,boot_sys_role_menu
        ,boot_sys_user
        ,boot_sys_user_role
        ,mysql.help_topic
        WHERE boot_sys_menu.id = boot_sys_role_menu.menu_id
        AND boot_sys_role_menu.role_id = boot_sys_role.id
        AND boot_sys_user.id = boot_sys_user_role.user_id
        AND boot_sys_role.id = boot_sys_user_role.role_id
        and help_topic_id &lt; length(permissions) - length(replace(permissions,',','')) + 1
        AND boot_sys_user.id = #{userId}
        order by boot_sys_menu.update_date desc
    </select>

</mapper>
